==============================================
GUIDE DE TEST - SYST√àME DE RAPPELS 3H
==============================================

√âTAPE 1 : CR√âER UN RENDEZ-VOUS DE TEST DANS 3 HEURES
-----------------------------------------------------
1. Aller sur : http://localhost:3000/prendre-rendez-vous

2. Cr√©er un rendez-vous avec ces informations :
   - Centre : Clichy ou Colombes
   - Date : Aujourd'hui
   - Heure : Dans 3 heures (exemple : s'il est 14h30, mettre 17h30)
   - Email : Votre email de test
   - Autres infos : Remplir le formulaire normalement

3. Confirmer la r√©servation


√âTAPE 2 : TESTER L'API DE RAPPEL MANUELLEMENT
----------------------------------------------
Commande curl pour tester l'API :

curl -X GET http://localhost:3000/api/reminders/send-3h-before \
-H "Authorization: Bearer VOTRE_CRON_SECRET"

Remplacer VOTRE_CRON_SECRET par la valeur dans votre .env.local


√âTAPE 3 : V√âRIFIER LES LOGS
----------------------------
Dans la console du serveur Next.js, vous devriez voir :

üîî [REMINDER-3H] V√©rification des rendez-vous entre...
üìß [REMINDER-3H] X rappel(s) √† envoyer
‚úÖ [REMINDER-3H] Rappel envoy√© √† email@example.com


√âTAPE 4 : V√âRIFIER L'EMAIL
---------------------------
1. V√©rifier votre bo√Æte email
2. Vous devriez recevoir un email avec :
   - Titre : "Rappel : Votre rendez-vous - Test Psychotechnique"
   - Header bleu avec "Rappel de rendez-vous"
   - D√©tails du RDV (date, heure, adresse)
   - Plan d'acc√®s d√©taill√© (selon Clichy ou Colombes)
   - Code 6138A pour Clichy
   - Rappels importants


√âTAPE 5 : V√âRIFIER LA BASE DE DONN√âES
--------------------------------------
Dans Supabase, v√©rifier la table appointments :

SELECT id, first_name, email, appointment_date, appointment_time, 
       reminder_3h_sent, reminder_3h_sent_at
FROM appointments
WHERE email = 'votre-email-de-test@example.com'
ORDER BY created_at DESC
LIMIT 1;

Vous devriez voir :
- reminder_3h_sent = true
- reminder_3h_sent_at = timestamp actuel


==============================================
TEST RAPIDE VIA NODE.JS
==============================================

Cr√©er un fichier test-rappel-api.mjs et y mettre :

import fetch from 'node-fetch';

const CRON_SECRET = 'votre-secret-ici'; // Remplacer
const API_URL = 'http://localhost:3000/api/reminders/send-3h-before';

async function testRappel() {
  console.log('üß™ Test du syst√®me de rappels 3h...\n');
  
  try {
    const response = await fetch(API_URL, {
      method: 'GET',
      headers: {
        'Authorization': `Bearer ${CRON_SECRET}`
      }
    });
    
    const data = await response.json();
    
    console.log('üìä R√©sultat du test:');
    console.log(JSON.stringify(data, null, 2));
    
    if (data.success) {
      console.log('\n‚úÖ Test r√©ussi!');
      console.log(`   ${data.successCount} email(s) envoy√©(s)`);
    } else {
      console.log('\n‚ùå Test √©chou√©');
    }
  } catch (error) {
    console.error('‚ùå Erreur:', error.message);
  }
}

testRappel();

Puis ex√©cuter :
node test-rappel-api.mjs


==============================================
PROBL√àMES COURANTS
==============================================

Probl√®me : "Non autoris√©" (401)
Solution : V√©rifier que CRON_SECRET est correct

Probl√®me : "Aucun rendez-vous √† rappeler"
Solution : 
- V√©rifier que le RDV est bien dans 3h
- V√©rifier que le statut est "confirmed"
- V√©rifier que reminder_3h_sent = false

Probl√®me : "appointment_datetime does not exist"
Solution : Vous avez d√©j√† ex√©cut√© le script SQL corrig√©

Probl√®me : Email non re√ßu
Solution :
- V√©rifier les logs pour l'erreur exacte
- V√©rifier ELASTIC_EMAIL_API_KEY
- V√©rifier que le template existe dans Supabase


==============================================
CHECKLIST AVANT TEST
==============================================

‚ñ° Script SQL ex√©cut√© dans Supabase (add-reminder-3h-columns.txt)
‚ñ° CRON_SECRET d√©fini dans .env.local
‚ñ° Serveur Next.js d√©marr√© (npm run dev)
‚ñ° Template de rappel mis √† jour dans Supabase
‚ñ° Rendez-vous cr√©√© dans exactement 3 heures
