================================================================================
üìã DOCUMENTATION DE PASSATION - TEST PSYCHOTECHNIQUE PERMIS
================================================================================

Date de cr√©ation: 11 Octobre 2025
Projet: Site de r√©servation de tests psychotechniques pour permis de conduire
Domaine: https://test-psychotechnique-permis.com

================================================================================
üìö TABLE DES MATI√àRES
================================================================================

1. VUE D'ENSEMBLE DU PROJET
2. ARCHITECTURE TECHNIQUE
3. CONFIGURATION ENVIRONNEMENT
4. BASE DE DONN√âES SUPABASE
5. SYST√àME D'EMAIL
6. ESPACE ADMINISTRATEUR
7. SYST√àME DE R√âSERVATION
8. D√âPLOIEMENT
9. SCRIPTS UTILES
10. MAINTENANCE ET D√âPANNAGE
11. CONTACTS ET ACC√àS

================================================================================
1. VUE D'ENSEMBLE DU PROJET
================================================================================

DESCRIPTION:
Site web professionnel pour la r√©servation de tests psychotechniques obligatoires
pour la r√©cup√©ration du permis de conduire. Centre agr√©√© situ√© √† Clichy (92).

FONCTIONNALIT√âS PRINCIPALES:
‚úÖ R√©servation en ligne avec calendrier interactif
‚úÖ Paiement sur place (pas de paiement en ligne)
‚úÖ Envoi automatique d'emails de confirmation
‚úÖ Rappels automatiques 24h avant le rendez-vous
‚úÖ Dashboard administrateur complet
‚úÖ Gestion des cr√©neaux horaires
‚úÖ Syst√®me de notifications
‚úÖ Export des statistiques (CSV, PDF)
‚úÖ Nettoyage automatique des anciens rendez-vous

INFORMATIONS DU CENTRE:
- Nom: Test Psychotechnique Permis - Centre Agr√©√© Clichy
- Adresse: 82 Rue Henri Barbusse, 92110 Clichy
- T√©l√©phone: 07 65 56 53 79
- Email contact: contact@test-psychotechnique-permis.com
- Email r√©servation: reservation@test-psychotechnique-permis.com
- Responsable: Fatiha Sebti (sebtifatiha@live.fr)

================================================================================
2. ARCHITECTURE TECHNIQUE
================================================================================

STACK TECHNIQUE:
- Framework: Next.js 14.2.3 (App Router)
- Langage: TypeScript
- Styling: Tailwind CSS + Framer Motion (animations)
- Base de donn√©es: Supabase (PostgreSQL)
- Email: Elastic Email API
- H√©bergement: OVH (√† d√©ployer)
- Gestion de version: Git + GitHub

STRUCTURE DU PROJET:
```
permis-expert/
‚îú‚îÄ‚îÄ app/                          # Pages et routes Next.js
‚îÇ   ‚îú‚îÄ‚îÄ api/                      # API Routes
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin/               # APIs admin (auth, CRUD)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ appointments/        # Gestion rendez-vous
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ available-slots/     # Cr√©neaux disponibles
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cron/                # T√¢ches automatis√©es
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ email/               # Gestion emails
‚îÇ   ‚îú‚îÄ‚îÄ admin/                   # Interface admin
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/          # Composants admin
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dashboard/           # Tableau de bord
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ creneaux/            # Gestion cr√©neaux
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ notifications/       # Notifications
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ settings/            # Param√®tres admin
‚îÇ   ‚îú‚îÄ‚îÄ prendre-rendez-vous/     # Page de r√©servation
‚îÇ   ‚îú‚îÄ‚îÄ contact/                 # Page contact
‚îÇ   ‚îú‚îÄ‚îÄ a-propos/                # Page √† propos
‚îÇ   ‚îî‚îÄ‚îÄ [...autres pages]/       # Pages informatives
‚îú‚îÄ‚îÄ components/                   # Composants r√©utilisables
‚îú‚îÄ‚îÄ lib/                         # Utilitaires et services
‚îÇ   ‚îú‚îÄ‚îÄ supabase.ts             # Client Supabase
‚îÇ   ‚îú‚îÄ‚îÄ emailService.ts         # Service d'envoi email
‚îÇ   ‚îú‚îÄ‚îÄ emailTemplates.ts       # Templates HTML emails
‚îÇ   ‚îú‚îÄ‚îÄ adminLogger.ts          # Logging admin
‚îÇ   ‚îî‚îÄ‚îÄ env.ts                  # Validation variables env
‚îú‚îÄ‚îÄ public/                      # Assets statiques
‚îú‚îÄ‚îÄ styles/                      # Styles globaux
‚îî‚îÄ‚îÄ scripts/                     # Scripts Node.js utiles

```

D√âPENDANCES PRINCIPALES:
- @supabase/supabase-js: ^2.39.3 (BDD)
- framer-motion: ^11.0.8 (Animations)
- date-fns: ^3.3.1 (Manipulation dates)
- bcryptjs: ^2.4.3 (Hash mots de passe)
- jspdf & jspdf-autotable: Export PDF
- papaparse: Export CSV

================================================================================
3. CONFIGURATION ENVIRONNEMENT
================================================================================

FICHIERS REQUIS:
- .env.local (d√©veloppement)
- .env.production (production)

VARIABLES D'ENVIRONNEMENT CRITIQUES:

# Supabase
NEXT_PUBLIC_SUPABASE_URL=https://hzfpscgdyrqbplmhgwhi.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh6ZnBzY2dkeXJxYnBsbWhnd2hpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk0MDQ3NTMsImV4cCI6MjA3NDk4MDc1M30.NxhJGc8TxYaw8UmWFLPxdGd8Q5yN25Cpq757T0J3MyA

# Elastic Email API
ELASTIC_EMAIL_API_KEY=B0D3C9F949F85DF5B9045463F6B4A04C1194929A06D05B8B972AAC0B14682CEFB03CA8FA79579D005F264103C6C92987
FROM_EMAIL=contact@test-psychotechnique-permis.com
ADMIN_EMAIL=sebtifatiha@live.fr

# Application
NEXT_PUBLIC_APP_URL=https://test-psychotechnique-permis.com
NODE_ENV=production

‚ö†Ô∏è IMPORTANT: Ces cl√©s sont sensibles. Ne JAMAIS les commiter dans Git.

INSTALLATION:
```bash
# Cloner le repo
git clone https://github.com/adellkl/test-psychotechnique-permis.git
cd permis-expert

# Installer les d√©pendances
npm install

# Cr√©er .env.local avec les variables ci-dessus
cp .env.example .env.local
# √âditer .env.local avec les vraies valeurs

# Lancer en d√©veloppement
npm run dev

# Build production
npm run build

# Lancer en production
npm start
```

================================================================================
4. BASE DE DONN√âES SUPABASE
================================================================================

ACC√àS SUPABASE:
- URL Dashboard: https://supabase.com/dashboard/project/hzfpscgdyrqbplmhgwhi
- Email: adelloukal2@gmail.com
- Mot de passe: [Demander au propri√©taire]

TABLES PRINCIPALES:

1. appointments (Rendez-vous)
   - id (uuid, PK)
   - first_name, last_name, email, phone
   - appointment_date, appointment_time
   - status (pending, confirmed, completed, cancelled)
   - location, test_type, duration
   - created_at, updated_at

2. admins (Administrateurs)
   - id (uuid, PK)
   - email (unique)
   - password_hash (bcrypt)
   - full_name, phone
   - role (admin)
   - is_active (boolean)
   - created_at

3. time_slots (Cr√©neaux horaires)
   - id (uuid, PK)
   - date, start_time, end_time
   - location, max_capacity
   - is_available (boolean)
   - created_at

4. notifications (Notifications admin)
   - id (uuid, PK)
   - admin_id (FK)
   - type (new_appointment, cancellation, reminder)
   - message, is_read
   - appointment_id (FK)
   - created_at

5. admin_activity_logs (Logs d'activit√©)
   - id (uuid, PK)
   - admin_id (FK)
   - action, details
   - ip_address, user_agent
   - created_at

6. email_templates (Templates emails)
   - id (uuid, PK)
   - name (unique)
   - subject, html_content
   - variables (jsonb)
   - is_active, created_at, updated_at

POLITIQUES RLS (Row Level Security):
- Toutes les tables ont des politiques permettant l'acc√®s complet
- S√©curit√© g√©r√©e c√¥t√© application Next.js
- Pas de r√©cursion dans les politiques

INDEXES POUR PERFORMANCE:
- idx_appointments_status_date (appointments)
- idx_appointments_email (appointments)
- idx_notifications_admin_unread (notifications)
- idx_admin_logs_admin_date (admin_activity_logs)

SCRIPT D'INITIALISATION:
Le fichier supabase-tables-setup.sql contient tout le sch√©ma.
Ex√©cuter dans l'√©diteur SQL de Supabase.

================================================================================
5. SYST√àME D'EMAIL
================================================================================

SERVICE UTILIS√â: Elastic Email API
- Plan: Payant (20‚Ç¨/mois)
- Limite: Illimit√©e
- D√©livrabilit√©: Excellente

CONFIGURATION DNS (OVH):
Les enregistrements DNS suivants sont configur√©s pour test-psychotechnique-permis.com:

SPF:
v=spf1 include:_spf.elasticemail.com include:mx.ovh.com ~all

DKIM:
api._domainkey ‚Üí Configuration Elastic Email

CNAME bounce:
bounce ‚Üí bounces.elasticemail.net

EMAILS AUTOMATIS√âS:

1. Confirmation de rendez-vous (Client)
   - Envoy√© imm√©diatement apr√®s r√©servation
   - Template: appointment_confirmation_client
   - Contient: date, heure, lieu, instructions

2. Notification admin (Nouveau RDV)
   - Envoy√© √† sebtifatiha@live.fr
   - Template: appointment_notification_admin
   - Contient: infos client, d√©tails RDV

3. Rappel 24h avant
   - Envoy√© automatiquement via CRON
   - Template: appointment_reminder
   - Contient: rappel avec d√©tails

4. Annulation
   - Envoy√© lors d'annulation
   - Template: appointment_cancellation
   - Contient: confirmation annulation

TEMPLATES:
Les templates HTML sont stock√©s dans:
- Base de donn√©es: table email_templates
- Code: lib/emailTemplates.ts

VARIABLES DISPONIBLES:
{{first_name}}, {{last_name}}, {{email}}, {{phone}}
{{appointment_date}}, {{appointment_time}}, {{duration}}
{{location}}, {{address}}, {{location_details}}
{{contact_phone}}, {{website}}, {{test_type}}

FICHIER PRINCIPAL:
lib/emailService.ts contient toutes les fonctions d'envoi.

TEST D'EMAIL:
```bash
node test-send-email.js
```

================================================================================
6. ESPACE ADMINISTRATEUR
================================================================================

ACC√àS ADMIN:
URL: https://test-psychotechnique-permis.com/admin

COMPTES ADMINISTRATEURS ACTUELS:

1. Compte Principal
   - Email: sebtifatiha@live.fr
   - Mot de passe: Admin123!
   - R√¥le: Administrateur principal
   - Nom: Fatiha Sebti

2. Compte D√©veloppeur
   - Email: adelloukal2@gmail.com
   - Mot de passe: Adelloulou93350
   - R√¥le: D√©veloppeur
   - Nom: Adel Loukal

FONCTIONNALIT√âS ADMIN:

1. Dashboard (/admin/dashboard)
   - Statistiques en temps r√©el
   - Graphiques (rendez-vous par jour, statuts, lieux)
   - Liste des rendez-vous r√©cents
   - Notifications non lues
   - Export CSV/PDF

2. Gestion des cr√©neaux (/admin/creneaux)
   - Cr√©ation de cr√©neaux horaires
   - Modification/suppression
   - Gestion de la disponibilit√©
   - Vue calendrier

3. Notifications (/admin/notifications)
   - Nouveaux rendez-vous
   - Annulations
   - Rappels
   - Marquage lu/non lu

4. Param√®tres (/admin/settings)
   - Modification profil admin
   - Changement mot de passe
   - Envoi d'emails de test
   - Logs d'activit√©

5. Nettoyage BDD
   - Suppression rendez-vous anciens
   - Filtres par statut et date
   - Pr√©visualisation avant suppression
   - Suppression individuelle ou en masse

S√âCURIT√â ADMIN:
- Mots de passe hash√©s avec bcrypt (10 rounds)
- V√©rification mot de passe avant changement
- Logging de toutes les actions
- Session s√©curis√©e
- Pas d'inscription publique (cr√©ation manuelle)

CR√âATION NOUVEAU ADMIN:
Utiliser le script: scripts/create-admin.js
```bash
node scripts/create-admin.js
```

================================================================================
7. SYST√àME DE R√âSERVATION
================================================================================

PROCESSUS DE R√âSERVATION:

1. Client visite /prendre-rendez-vous
2. S√©lectionne date dans le calendrier
3. Choisit cr√©neau horaire disponible
4. Remplit formulaire (nom, pr√©nom, email, t√©l√©phone)
5. Valide la r√©servation
6. Re√ßoit email de confirmation imm√©diatement
7. Admin re√ßoit notification email

VALIDATION:
- V√©rification disponibilit√© en temps r√©el
- Validation email format
- Validation t√©l√©phone fran√ßais
- Pr√©vention double r√©servation

API ENDPOINTS:

GET /api/available-slots
- Param√®tres: date, location
- Retourne: cr√©neaux disponibles

POST /api/appointments
- Body: infos client + cr√©neau
- Retourne: confirmation + envoi emails

POST /api/appointments/cancel
- Body: appointment_id, email
- Retourne: confirmation annulation

CALENDRIER:
- Composant: components/Calendar.tsx
- Librairie: date-fns
- D√©sactive dates pass√©es
- Affiche disponibilit√©s

CR√âNEAUX HORAIRES:
- Configurables par l'admin
- Dur√©e: 30min ou 1h
- Capacit√© max par cr√©neau
- Plusieurs lieux possibles

================================================================================
8. D√âPLOIEMENT
================================================================================

H√âBERGEMENT: OVH
- Type: H√©bergement web mutualis√© ou VPS
- Domaine: test-psychotechnique-permis.com
- Certificat SSL: Let's Encrypt (gratuit)

PROCESSUS DE D√âPLOIEMENT:

1. Build local:
```bash
npm run build
```

2. V√©rifier .env.production

3. Upload via FTP/SFTP:
   - Dossier .next/
   - Dossier public/
   - Fichiers package.json, next.config.js
   - node_modules/ (ou npm install sur serveur)

4. Configuration serveur:
   - Node.js version 18+
   - PM2 pour process management
   - Nginx comme reverse proxy

5. D√©marrage:
```bash
npm install --production
npm start
```

CONFIGURATION NGINX (exemple):
```nginx
server {
    listen 80;
    server_name test-psychotechnique-permis.com;
    
    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}
```

T√ÇCHES CRON:
Configurer sur le serveur pour:

1. Rappels 24h avant:
```bash
0 9 * * * curl https://test-psychotechnique-permis.com/api/cron/send-confirmation-reminders
```

2. Marquer rendez-vous compl√©t√©s:
```bash
0 0 * * * curl https://test-psychotechnique-permis.com/api/cron/mark-completed
```

MONITORING:
- Logs serveur: /var/log/nginx/
- Logs application: PM2 logs
- Supabase Dashboard pour BDD
- Elastic Email Dashboard pour emails

================================================================================
9. SCRIPTS UTILES
================================================================================

SCRIPTS NODE.JS DISPONIBLES:

1. check-all-admins.js
   - Liste tous les comptes admin
   - Affiche emails et statuts
   ```bash
   node check-all-admins.js
   ```

2. reset-admin-account.js
   - Cr√©e/r√©initialise compte admin
   - G√©n√®re nouveau hash bcrypt
   ```bash
   node reset-admin-account.js
   ```

3. get-admin-password.js
   - R√©cup√®re infos de connexion
   - Affiche emails des admins
   ```bash
   node get-admin-password.js
   ```

4. test-send-email.js
   - Test envoi email Elastic Email
   - V√©rifie configuration
   ```bash
   node test-send-email.js
   ```

5. test-supabase-connection.js
   - Test connexion Supabase
   - V√©rifie tables et donn√©es
   ```bash
   node test-supabase-connection.js
   ```

COMMANDES NPM:
```bash
npm run dev          # D√©veloppement (port 3000)
npm run build        # Build production
npm start            # D√©marrage production
npm run lint         # V√©rification code
```

================================================================================
10. MAINTENANCE ET D√âPANNAGE
================================================================================

PROBL√àMES COURANTS:

1. Emails non re√ßus
   ‚úì V√©rifier cl√© API Elastic Email
   ‚úì V√©rifier DNS (SPF, DKIM)
   ‚úì Consulter dashboard Elastic Email
   ‚úì V√©rifier logs: lib/emailService.ts

2. Erreur connexion Supabase
   ‚úì V√©rifier NEXT_PUBLIC_SUPABASE_URL
   ‚úì V√©rifier NEXT_PUBLIC_SUPABASE_ANON_KEY
   ‚úì Tester avec test-supabase-connection.js
   ‚úì V√©rifier politiques RLS

3. Admin ne peut pas se connecter
   ‚úì V√©rifier email existe: check-all-admins.js
   ‚úì R√©initialiser mot de passe: reset-admin-account.js
   ‚úì V√©rifier colonne password_hash en BDD
   ‚úì Logs: admin_activity_logs table

4. Cr√©neaux non disponibles
   ‚úì V√©rifier table time_slots
   ‚úì V√©rifier is_available = true
   ‚úì V√©rifier date >= aujourd'hui
   ‚úì API: /api/available-slots

5. Build √©choue
   ‚úì npm install pour d√©pendances
   ‚úì V√©rifier erreurs TypeScript
   ‚úì Supprimer .next/ et rebuilder
   ‚úì V√©rifier versions Node.js (18+)

LOGS ET DEBUGGING:

Console navigateur:
- Ouvrir DevTools (F12)
- Onglet Console pour erreurs JS
- Onglet Network pour requ√™tes API

Logs serveur:
```bash
# PM2
pm2 logs

# Nginx
tail -f /var/log/nginx/error.log
tail -f /var/log/nginx/access.log
```

Logs Supabase:
- Dashboard Supabase > Logs
- Voir requ√™tes SQL et erreurs

SAUVEGARDE:

Base de donn√©es:
- Supabase fait des backups automatiques
- Export manuel: Dashboard > Database > Backup

Code:
- Git: https://github.com/adellkl/test-psychotechnique-permis
- Branches: main (production)

MISES √Ä JOUR:

D√©pendances:
```bash
npm outdated          # Voir packages obsol√®tes
npm update            # Mettre √† jour
npm audit fix         # Corriger vuln√©rabilit√©s
```

Next.js:
```bash
npm install next@latest react@latest react-dom@latest
```

================================================================================
11. CONTACTS ET ACC√àS
================================================================================

PROPRI√âTAIRE DU PROJET:
- Nom: Fatiha Sebti
- Email: sebtifatiha@live.fr
- T√©l√©phone: 07 65 56 53 79
- R√¥le: G√©rante du centre

D√âVELOPPEUR ACTUEL:
- Nom: Adel Loukal
- Email: adelloukal2@gmail.com
- GitHub: adellkl

ACC√àS TECHNIQUES:

GitHub:
- Repo: https://github.com/adellkl/test-psychotechnique-permis
- Acc√®s: Demander invitation au propri√©taire

Supabase:
- Dashboard: https://supabase.com/dashboard/project/hzfpscgdyrqbplmhgwhi
- Email: adelloukal2@gmail.com
- Mot de passe: [Demander]

Elastic Email:
- Dashboard: https://elasticemail.com/account
- Email: adelloukal2@gmail.com
- Mot de passe: [Demander]
- API Key: Voir section 3

OVH:
- Manager: https://www.ovh.com/manager/
- Email: [√Ä d√©finir]
- Mot de passe: [√Ä d√©finir]

DOMAINE:
- Registrar: OVH
- Domaine: test-psychotechnique-permis.com
- Expiration: [V√©rifier sur OVH]
- DNS: G√©r√© par OVH

EMAILS PROFESSIONNELS (OVH):
- contact@test-psychotechnique-permis.com
- reservation@test-psychotechnique-permis.com
- sebti.fatiha@test-psychotechnique-permis.com

================================================================================
üìù NOTES IMPORTANTES
================================================================================

1. S√âCURIT√â:
   - Ne JAMAIS commiter les fichiers .env*
   - Changer les mots de passe admin r√©guli√®rement
   - V√©rifier les logs d'activit√© admin
   - Garder les d√©pendances √† jour

2. PERFORMANCE:
   - Build optimis√© avec Next.js 14
   - Images optimis√©es avec next/image
   - Animations GPU avec Framer Motion
   - Indexes BDD pour requ√™tes rapides

3. SEO:
   - Metadata optimis√©s dans layout.tsx
   - Sitemap.xml et robots.txt configur√©s
   - Structured data (JSON-LD)
   - URLs canoniques

4. ACCESSIBILIT√â:
   - Animations respectent prefers-reduced-motion
   - Alt text sur toutes les images
   - Navigation au clavier
   - Contraste WCAG AA

5. RESPONSIVE:
   - Mobile-first design
   - Breakpoints Tailwind
   - Test√© sur iOS/Android
   - Touch-friendly

================================================================================
üìû SUPPORT
================================================================================

En cas de probl√®me urgent:
1. Consulter cette documentation
2. V√©rifier les logs (serveur, Supabase, Elastic Email)
3. Tester avec les scripts de diagnostic
4. Contacter le d√©veloppeur actuel
5. Contacter le propri√©taire du projet

Pour questions techniques:
- GitHub Issues: https://github.com/adellkl/test-psychotechnique-permis/issues
- Email d√©veloppeur: adelloukal2@gmail.com

Pour questions business:
- Email propri√©taire: sebtifatiha@live.fr
- T√©l√©phone: 07 65 56 53 79

================================================================================
‚úÖ CHECKLIST DE PASSATION
================================================================================

Avant de passer le projet, v√©rifier:

‚ñ° Acc√®s GitHub fourni au nouveau d√©veloppeur
‚ñ° Acc√®s Supabase transf√©r√©
‚ñ° Acc√®s Elastic Email transf√©r√©
‚ñ° Acc√®s OVH transf√©r√©
‚ñ° Variables d'environnement partag√©es (s√©curis√©)
‚ñ° Documentation lue et comprise
‚ñ° Tests effectu√©s (emails, r√©servations, admin)
‚ñ° Mots de passe admin chang√©s
‚ñ° Backup base de donn√©es effectu√©
‚ñ° Code √† jour sur GitHub
‚ñ° Build production test√©
‚ñ° T√¢ches CRON configur√©es
‚ñ° Monitoring en place
‚ñ° Contact propri√©taire √©tabli

================================================================================
üìÖ HISTORIQUE DES VERSIONS
================================================================================

v1.0.0 - Octobre 2025
- Lancement initial du site
- Syst√®me de r√©servation complet
- Dashboard administrateur
- Emails automatis√©s
- Export statistiques

v1.1.0 - Octobre 2025
- Ajout nettoyage BDD
- Am√©lioration s√©curit√© admin
- Optimisation performances
- Correction bugs emails

================================================================================
FIN DE LA DOCUMENTATION
================================================================================

Cette documentation a √©t√© cr√©√©e le 11 Octobre 2025.
Pour toute mise √† jour, modifier ce fichier et commiter sur Git.

Bonne chance avec le projet ! üöÄ
